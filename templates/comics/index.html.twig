{% extends 'base.html.twig' %}

{% block title %}Hello ComicsController!{% endblock %}

{% block body %}

    <h1>Comics</h1>

    <input type="text" id="search-bar" placeholder="Rechercher un comic..."/>

    <div class="comic-list" id="comic-list">
        {% for comic in comics %}
            <div class="comic-card">
                <img src="{{ comic.thumbnail }}" alt="{{ comic.title }}">
                <h3>{{ comic.title }}</h3>
                <p>{{ comic.date ? comic.date : 'Pas de date' }}</p>
            </div>
        {% else %}
            <p>Aucun comic trouvé.</p>
        {% endfor %}
    </div>

    <script>
        const searchInput = document.getElementById('search-bar');
        const comicList = document.getElementById('comic-list');

        searchInput.addEventListener('input', function () {
            const query = searchInput.value.trim();

            fetch(`/api/comics?search=${encodeURIComponent(query)}&limit=20&sort=alpha`)
                .then(response => response.json())
                .then(data => {
                    comicList.innerHTML = '';

                    if (data.data.length === 0) {
                        comicList.innerHTML = '<p>Aucun comic trouvé.</p>';
                        return;
                    }

                    data.data.forEach(comic => {
                        const card = document.createElement('div');
                        card.className = 'comic-card';
                        card.innerHTML = `
                    <img src="${comic.thumbnail}" alt="${comic.title}">
                    <h3>${comic.title}</h3>
                    <p>${comic.date ? comic.date : 'Pas de date'}</p>
                `;
                        comicList.appendChild(card);
                    });
                })
                .catch(err => {
                    console.error('Erreur API:', err);
                    comicList.innerHTML = '<p>Erreur lors de la récupération des comics.</p>';
                });
        });
    </script>


{% endblock %}
